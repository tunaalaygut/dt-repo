<!doctype html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<div th:replace="fragments/fragments :: head(content = 'Toplantı Talep Formu')"></div>

<body>

<div class="wrapper">
	<div th:replace="fragments/fragments :: sidebar"></div>
		<div class="content">
            <div th:replace="fragments/fragments :: navbar"></div>
            <h2 class="mb-4">Toplantı Talep Formu</h2>

			<!--MEETING_REQUEST_FORM BEGINS-->
            <form th:action="@{/add/meetingRequest}" th:object="${addMeetingRequestForm}" th:method="post" autocomplete="off">


				<!--TIME INFO STARTS-->
				<div class="row">
					<div class="col-md-6">
						<div class="form-group">
							<label>Toplantı Tarihi:</label>
							<input type="date" th:field="*{date}" class="form-control" placeholder="Toplantı Tarihi"/>
						</div>
					</div>
					<div class="col-md-6">
						<div class="row">
							<div class="col-sm-6">
								<div class="form-group">
									<label for="beginningTimeInput">Başlangıç Saati:</label>
									<select  th:field="*{beginningTime}" class="custom-select" id="beginningTimeInput">
										<option th:each="time : ${addMeetingRequestForm.times}" th:value="${time}" th:text="${time}">
										</option>
									</select>
								</div>
							</div>
							<div class="col-sm-6">
								<div class="form-group">
									<label for="endTimeInput">Bitiş Saati:</label>
									<select th:field="*{endTime}" class="custom-select" id="endTimeInput">
										<option th:each="time : ${addMeetingRequestForm.times}" th:value="${time}" th:text="${time}">
										</option>
									</select>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!--TIME INFO ENDS-->


				<!--LOGISTICS START HERE-->

				<div class="row">
					<div class="col-sm-6">
						<div class="form-group">
							<label for="buildingId">Bina:</label>
							<select th:field="*{buildingId}" class="custom-select" id="buildingId">
								<option th:each="building : *{allBuildings}" th:value="${building.buildingId}" th:text="${building.buildingName}">
								</option>
							</select>
						</div>
					</div>
					<div class="col-sm-6">
						<div class="form-group">
							<label for="meetingRoomId">Toplantı Odası</label>
							<select th:field="*{meetingRoomId}" class="custom-select" id="meetingRoomId">
								<!--<option th:each="meetingRoom : *{allMeetingRooms}" th:value="${meetingRoom.meetingRoomId}" th:text="${meetingRoom.meetingRoomName}">
								</option>-->
								<option value="0">-</option>
							</select>
						</div>
					</div>
				</div>

				<!--LOGISTICS END HERE-->


				<!--PARTICIPANTS START HERE-->
				<div class="row my-5">
					<div class="col-sm-6">
						<div class="row">
							<div class="col">
								<form>
									<div class="form-group">
										<label for="exampleInputEmail1">Kullanıcı:</label>
<!--
										<input type="text" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Kullanıcı bilgileri">
-->
										<div class="table-responsive">
											<table class="table" id="example">
												<thead>
												<tr>
													<th scope="col">İsim</th>
													<th scope="col">E-mail</th>
													<th scope="col">Ekle</th>
												</tr>
												</thead>
												<tbody>
												<tr th:each="member : *{allMembers}">
													<td th:text="${member.firstName + ' ' + member.lastName}"></td>
													<td th:text="${member.email}"></td>
													<td class="text-center">
														<button class="btn btn-outline-info btn-sm" style="border-radius:50%;"><span class="fas fa-plus"></span></button>
													</td>
												</tr>
												</tbody>
											</table>
										</div>
									</div>
								</form>
							</div>
						</div>
						<div class="row">
							<div class="col">
								<form>
									<div class="form-group">
										<label for="exampleInputEmail1">Misafir Adı Soyadı:</label>
										<input type="text" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Ad Soyad">
									</div>
									<div class="form-group">
										<label for="exampleInputPassword1">E-mail:</label>
										<input type="email" class="form-control" id="exampleInputPassword1" placeholder="E-mail">
									</div>
									<button type="submit" class="btn btn-info btn-block">Misafir Katılımcı Ekle</button>
								</form>
							</div>
						</div>
					</div>
					<div class="col-sm-6">
						<div class="row">
							<div class="col">
								<form>
									<div class="form-group">
										<label for="exampleInputEmail1">Katımlıcılar:</label>
										<!--
                                                                                <input type="text" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Kullanıcı bilgileri">
                                        -->
										<div class="table-responsive">
											<table class="table" id="example2">
												<thead>
												<tr>
													<th scope="col">İsim</th>
													<th scope="col">E-mail</th>
													<th scope="col">Ekle</th>
												</tr>
												</thead>
												<tbody>
												<tr th:each="member : *{addedMembers}">
													<td th:text="${member.firstName + ' ' + member.lastName}"></td>
													<td th:text="${member.email}"></td>
													<td class="text-center">
														<form id="addParticipantForm" th:action="@{/addMemberToParticipants/__(${member.memberId})__}" method="get"></form>
														<button class="btn btn-outline-info btn-sm" style="border-radius:50%;"><span class="fas fa-plus"></span></button>
													</td>
												</tr>
												</tbody>
											</table>
										</div>
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>
				<!--PARTICIPANTS END HERE-->




				<!--DESCRIPTION STARTS HERE-->
				<div class="form-group">
					<label for="meetingTypeSelectMenu">Toplantı Türü:</label>
					<select class="custom-select" id="meetingTypeSelectMenu" th:field="*{meetingTypeId}">
						<option th:each="type : ${addMeetingRequestForm.allMeetingTypes}" th:text="${type?.meetingTypeName}" th:value = "${type?.meetingTypeId}"></option>
					</select>
			  	</div>

				<div class="form-group">
					<label for="descriptionInput">Açıklama:</label>
					 <textarea th:field="*{description}" type="text" class="form-control" id="descriptionInput" placeholder="Açıklama" rows="3" style="resize: none;"></textarea>
				</div>
				<!--DESCRIPTION ENDS HERE-->





				<!--FEEDBACK_MESSAGES_START_HERE-->
				<div th:if="${#fields.hasErrors('date')}" th:errors="*{date}" class="alert alert-danger alert-dismissible fade show" role="alert"></div>
				<div th:if="${#fields.hasErrors('beginningTime')}" th:errors="*{beginningTime}" class="alert alert-danger alert-dismissible fade show" role="alert"></div>
				<div th:if="${#fields.hasErrors('endTime')}" th:errors="*{endTime}" class="alert alert-danger alert-dismissible fade show" role="alert"></div>
				<div th:if="${#fields.hasErrors('description')}" th:errors="*{description}" class="alert alert-danger alert-dismissible fade show" role="alert"></div>
				<!--FEEDBACK_MESSAGES_END_HERE-->
        		<button type="submit" class="btn btn-primary btn-info btn-block mt-5">Toplantı İsteği Oluştur</button>
    		</form>
		</div>
    </div>
   <div th:replace="fragments/fragments :: scripts"></div>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-chained/1.0.1/jquery.chained.remote.min.js" integrity="sha256-s4fvhjtBM8Qdr848fG5m3T6LjoJl799Qax4fr/24r30=" crossorigin="anonymous"></script>
	<script type="text/javascript">

		function getAndPopulateMeetingRooms(){
			let buildingId = $("#buildingId").val();
			let meetingRoomSelect = $("#meetingRoomId");

			$.ajax({
				url: "[[@{/getBuildingMeetingRooms}]]",
				data : {"buildingId" : buildingId}
			}).done(function(map) {
				meetingRoomSelect.empty();
				$.each(map, function(meetingRoomId, meetingRoomName)
				{
					console.log(meetingRoomId, meetingRoomName);
					meetingRoomSelect.append('<option value=' + meetingRoomId + '>' + meetingRoomName + '</option>');
				});
			});
		}

		$("#buildingId").change(function(){
			getAndPopulateMeetingRooms();
		});

		$( document ).ready(function() {
			getAndPopulateMeetingRooms();
		});

	</script>
</body>
</html>
